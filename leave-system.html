<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>員工請假管理系統</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #eef1f5;
}

.header {
  background: #2c3e50;
  color: white;
  padding: 14px;
  text-align: center;
  font-size: 18px;
}

.container {
  max-width: 420px;
  margin: auto;
  padding: 12px;
}

.card {
  background: white;
  border-radius: 10px;
  padding: 12px;
  margin-bottom: 12px;
}

input, select, textarea {
  width: 100%;
  padding: 6px;
  margin-top: 6px;
  border-radius: 6px;
  border: 1px solid #ddd;
  font-size: 13px;
  box-sizing: border-box;
}

textarea { height: 45px; }

button {
  width: 100%;
  padding: 8px;
  margin-top: 8px;
  border: none;
  border-radius: 6px;
  background: #3498db;
  color: white;
}

.workerTitle {
  font-weight: bold;
  margin-top: 10px;
  border-bottom: 1px solid #ddd;
}

.recordLine {
  font-size: 13px;
  padding: 4px 0;
}

.urgent {
  color: red;
  font-weight: bold;
}

.statLine {
  font-size: 13px;
  padding: 3px 0;
}
</style>
</head>

<body>

<div class="header">員工請假管理系統</div>

<div class="container">

<div class="card">
  新增員工
  <input id="newWorker">
  <button onclick="addWorker()">加入員工</button>
</div>

<div class="card">
  請假登記
  <select id="workerSelect"></select>

  請假日期
  <input type="date" id="date">

  請假類型
  <select id="leaveType">
    <option value="提前請假">提前請假</option>
    <option value="臨時請假">臨時請假</option>
  </select>

  請假事由
  <input id="reason">

  備註
  <textarea id="note"></textarea>

  提出日期
  <input type="date" id="reportDate">

  提出時間
  <input type="time" id="reportTime">

  告知對象
  <select id="reportTo">
    <option value="淦哥">淦哥</option>
    <option value="嫂子">嫂子</option>
  </select>

  <button onclick="addLeave()">送出</button>
</div>

<div class="card">
  數據統計
  <div id="stats"></div>

  <button onclick="clearAll()" style="background:#e74c3c;">
清除所有紀錄
</button>
</div>

<div class="card">
  請假紀錄
  <div id="list"></div>
</div>

</div>

<script>
let workers = JSON.parse(localStorage.getItem("workers")) || [];
let leaves = JSON.parse(localStorage.getItem("leaves")) || [];

function save() {
  localStorage.setItem("workers", JSON.stringify(workers));
  localStorage.setItem("leaves", JSON.stringify(leaves));
}

function renderWorkers() {
  const select = document.getElementById("workerSelect");
  select.innerHTML = "";
  workers.forEach(w => select.innerHTML += `<option>${w}</option>`);
}

function renderLeaves() {
  const list = document.getElementById("list");
  list.innerHTML = "";

  const grouped = {};
  leaves.forEach(l => {
    if (!grouped[l.worker]) grouped[l.worker] = [];
    grouped[l.worker].push(l);
  });

  Object.keys(grouped).forEach(worker => {
    list.innerHTML += `<div class="workerTitle">${worker}</div>`;

    grouped[worker].forEach(l => {
  list.innerHTML += `
    <div class="recordLine">
      ${l.date} ｜ 
      <span class="${l.type === '臨時請假' ? 'urgent' : ''}">
        ${l.type}
      </span>
      ｜ ${l.reason || "-"}
      ${l.note ? "｜ 備註：" + l.note : ""}
      <br>
      提出：${l.reportDate || "-"} ${l.reportTime || ""} → ${l.reportTo || "-"}
    </div>
  `;
});
  });
}

function renderStats() {
  const stats = document.getElementById("stats");
  stats.innerHTML = "";

  let total = leaves.length;
  let urgent = leaves.filter(l => l.type === "臨時請假").length;
  let advance = total - urgent;

  stats.innerHTML = `
    <div class="statLine">總請假：${total}</div>
    <div class="statLine">提前請假：${advance}</div>
    <div class="statLine">臨時請假：${urgent}</div>
  `;
}

function addWorker() {
  const name = document.getElementById("newWorker").value;
  if (!name) return;

  if (!workers.includes(name)) workers.push(name);

  document.getElementById("newWorker").value = "";
  save();
  renderWorkers();
}

function addLeave() {
  const worker = document.getElementById("workerSelect").value;
  const date = document.getElementById("date").value;
  const type = document.getElementById("leaveType").value;
  const reason = document.getElementById("reason").value;
  const note = document.getElementById("note").value;

  const reportDate = document.getElementById("reportDate").value;
  const reportTime = document.getElementById("reportTime").value;
  const reportTo = document.getElementById("reportTo").value;

  if (!worker || !date) return;

  leaves.push({
    worker,
    date,
    type,
    reason,
    note,
    reportDate,
    reportTime,
    reportTo
  });

  save();
  renderLeaves();
  renderStats();
}

renderWorkers();
renderLeaves();
renderStats();

function clearAll() {
  if (!confirm("確定要清除所有資料嗎？")) return;

  localStorage.removeItem("workers");
  localStorage.removeItem("leaves");

  workers = [];
  leaves = [];

  renderWorkers();
  renderLeaves();
  renderStats();
}
</script>

</body>
</html>
